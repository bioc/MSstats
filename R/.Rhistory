getwd()
load("~/Dropbox/visits/2017/05/2017-MayInstitute-Program5/Day2-May9/data_Skyline/test.limma.rda")
data<- test.limma
head(data)
sig=0.05
FCcutoff=FALSE
logBase.pvalue=10
ylimUp=FALSE
ylimDown=FALSE
xlimUp=FALSE
x.axis.size=10
y.axis.size=10
dot.size=3
text.size=4
legend.size=13
ProteinName=TRUE
width=10
height=10
data$Protein <- factor(data$Protein)
data$Label <- factor(data$Label)
if (logBase.pvalue == 2) {
y.limUp  <- 30
}
if (logBase.pvalue == 10) {
y.limUp  <- 10
}
library(ggplot2)
if (is.numeric(ylimUp)) y.limUp <- ylimUp
data <- data[!is.na(data$adj.pvalue),]
!FCcutoff
## group for coloring dots
if (!FCcutoff) {
data[data$adj.pvalue >= sig, "colgroup"] <- "black"
data[data$adj.pvalue < sig & data[, 3] > 0, "colgroup"] <- "red"
data[data$adj.pvalue < sig & data[, 3] < 0, "colgroup"] <- "blue"
}
is.numeric(FCcutoff)
data$colgroup <- factor(data$colgroup, levels=c("black", "blue", "red"))
i=1
sub <- data[data$Label == levels(data$Label)[i], ]
if (logBase.pvalue == 2) {
sub$adj.pvalue[sub$adj.pvalue < 2^(-y.limUp)] <- 2^(-y.limUp)
}
if (logBase.pvalue == 10) {
sub$adj.pvalue[sub$adj.pvalue < 10^(-y.limUp)] <- 10^(-y.limUp)
}
sub <- as.data.frame(sub)
if (logBase.pvalue == 2) {
y.limup <- ceiling(max(-log2(sub[!is.na(sub$adj.pvalue), "adj.pvalue"])))
if (y.limup < (-log2(sig))) {
y.limup <- (-log2(sig) + 1) ## for too small y.lim
}
}
if (logBase.pvalue == 10) {
y.limup <- ceiling(max(-log10(sub[!is.na(sub$adj.pvalue), "adj.pvalue"])))
if (y.limup < (-log10(sig))) {
y.limup <- (-log10(sig) + 1) ## for too small y.lim
}
}
## ylimDown
y.limdown <- 0 ## default is zero
if (is.numeric(ylimDown)) {
y.limdown <- ylimDown
}
x.lim <- ceiling(max(abs(sub[!is.na(sub[, 3]) & abs(sub[, 3]) != Inf , 3]))) ## log2FC or log10FC
if (x.lim < 3) {
x.lim <- 3
}
if (is.numeric(xlimUp)) {
x.lim <- xlimUp
}
## for assigning x in ggplot2
subtemp <- sub
colnames(subtemp)[3] <- "logFC"
if (logBase.pvalue == 2) {
subtemp$log2adjp <- (-log2(subtemp$adj.pvalue))
}
if (logBase.pvalue == 10) {
subtemp$log10adjp <- (-log10(subtemp$adj.pvalue))
}
## for x limit for inf or -inf
subtemp$newlogFC <- subtemp$logFC
subtemp[!is.na(subtemp$issue) & subtemp$issue == "oneConditionMissing" & subtemp$logFC == Inf, "newlogFC"] <- (x.lim - 0.2)
subtemp[!is.na(subtemp$issue) & subtemp$issue == "oneConditionMissing" & subtemp$logFC == (-Inf), "newlogFC"] <- (x.lim - 0.2) *(-1)
## add (*) in Protein name for Inf or -Inf
subtemp$Protein <- as.character(subtemp$Protein)
subtemp[!is.na(subtemp$issue) & subtemp$issue == "oneConditionMissing", "Protein"] <- paste("*", subtemp[!is.na(subtemp$issue) & subtemp$issue == "oneConditionMissing", "Protein"], sep="")
